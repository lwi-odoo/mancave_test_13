<odoo>
  <data>
    <record id="purchase_discount_wizard" model="ir.ui.view">
        <field name="name">purchase.discount.wizard.form</field>
        <field name="model">purchase.discount.wizard</field>
        <field name="arch" type="xml">
            <form>
              <sheet>
                <group>
                  <field name="fixed_discount" attrs="{'readonly': [('percent_discount','!=',0.0)]}" force_save="1"/>
                  <field name="percent_discount" attrs="{'readonly': [('fixed_discount','!=',0.0)]}" force_save="1"/>
                </group>
              </sheet>
              <footer>
                <button string="Apply Batch Discounts" type="object" name="set_discount" class="btn-primary"/>
                <button string="Cancel" class="btn-secondary" special="cancel"/>
              </footer>
            </form>
        </field>
    </record>

    <record id="product_supplierinfo_form_view_inherit" model="ir.ui.view">
        <field name="name">product.supplierinfo.discount.form</field>
        <field name="model">product.supplierinfo</field>
        <field name="inherit_id" ref="product.product_supplierinfo_form_view"/>
        <field name="priority">100</field>
        <field name="arch" type="xml">
          <xpath expr="//field[@name='company_id']/.." position="before">
            <group string="Discount">
              <field name="fixed_discount" attrs="{'readonly': [('percent_discount','!=',0.0)]}" force_save="1"/>
              <field name="percent_discount" attrs="{'readonly': [('fixed_discount','!=',0.0)]}" force_save="1"/>
            </group>
          </xpath>
        </field>
    </record>

    <record id="product_supplierinfo_tree_view_inherit" model="ir.ui.view">
        <field name="name">product.supplierinfo.discount.tree</field>
        <field name="model">product.supplierinfo</field>
        <field name="inherit_id" ref="product.product_supplierinfo_tree_view"/>
        <field name="priority">100</field>
        <field name="arch" type="xml">
          <xpath expr="//field[@name='currency_id']" position="after">
              <field name="fixed_discount"/>
              <field name="percent_discount"/>
          </xpath>
        </field>
    </record>

    <record id="purchase_order_form_view_inherit_discount" model="ir.ui.view">
        <field name="name">purchase.order.discount.form</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form"/>
        <field name="priority">100</field>
        <field name="arch" type="xml">
          <xpath expr="//header" position="inside">
            <button type="object" string="Apply Batch Discounts" name="discount_wizard_purchase" attrs="{'invisible': [('state','not in',['draft','sent','to approve'])]}"/>
          </xpath>
          <xpath expr="//field[@name='date_order']" position="after">
              <field name="global_discount" attrs="{'readonly': [('state','not in',['draft','sent','to approve'])]}" force_save="1"/>
          </xpath>
          <xpath expr="//field[@name='amount_tax']" position="before">
              <field name="total_discount"/>
          </xpath>
          <xpath expr="//field[@name='order_line']/tree/field[@name='product_qty']" position="attributes">
            <attribute name="sum">Total</attribute>
          </xpath>
          <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']" position="after">
            <field name="fixed_discount" attrs="{'readonly': ['|',('percent_discount','!=',0.0),('state','in',['purchase','done','cancel'])]}" force_save="1"/>
            <field name="percent_discount" attrs="{'readonly': ['|',('fixed_discount','!=',0.0),('state','in',['purchase','done','cancel'])]}" force_save="1"/>
          </xpath>
        </field>
    </record>


    <record id="account_move_form_view_inherit_discount" model="ir.ui.view">
        <field name="name">account.move.discount.form</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="priority">100</field>
        <field name="arch" type="xml">
          <xpath expr="//header" position="inside">
            <button type="object" string="Apply Batch Discounts" name="discount_wizard_invoice" attrs="{'invisible': [('type', '!=', 'in_invoice'), ('state','!=','draft')]}"/>
          </xpath>
          <xpath expr="//field[@name='journal_id']" position="after">
              <field name="global_discount" attrs="{'invisible':[('type', '!=', 'in_invoice')]}"/>
          </xpath>
          <xpath expr="//field[@name='amount_untaxed']" position="after">
              <field name="total_discount" attrs="{'invisible':[('type', '!=', 'in_invoice')]}"/>
          </xpath>
          <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='discount']" position="before">
              <field name="new_price_unit" invisible="1"/>
              <field name="fixed_discount" attrs="{'column_invisible':[('parent.type', '!=', 'in_invoice')]}"/>
          </xpath>
          <xpath expr="//field[@name='invoice_line_ids']/form//field[@name='discount']" position="before">
              <field name="new_price_unit" invisible="1"/>
              <field name="fixed_discount" attrs="{'column_invisible':[('parent.type', '!=', 'in_invoice')]}"/>
          </xpath>
          <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='quantity']" position="attributes">
            <attribute name="sum">Total</attribute>
          </xpath>
          <xpath expr="//field[@name='line_ids']/tree/field[@name='discount']" position="after">
              <field name="new_price_unit" invisible="1"/>
              <field name="fixed_discount" invisible="1"/>
          </xpath>
          <xpath expr="//field[@name='invoice_line_ids']/form//field[@name='discount']" position="after">
              <field name="new_price_unit" invisible="1"/>
              <field name="fixed_discount" invisible="1"/>
          </xpath>
        </field>
    </record>

  </data>
</odoo>